# Úvod

\qquad Vizualizace dat vždy hrála a neustále hraje významnou roli ve vědě. Je to jeden z nejlepších a jednoduchých způsobů pochopení dat. Vizualizace poskytuje jasnou představu o konfiguraci dat, odhaluje skryte struktury v datech a shrnuje informace. Proces vizualizaci je nedílnou součásti mnoha <!--lékařských --> analýz a téměř všechny <!-- přírodní --> vědy využívají grafického zobrazení dat k vizualizaci a komunikaci svých výsledků. <!-- Dlouhou tradici prezentace dat se vyznačuje i ekonomika. --> Sbírané a analyzované po dobu mnoha let data se v současné době převádějí do grafické formy. Masivní příliv dat a jejich dostupnost vedli k novým metodám a novým přístupům. Kombinace programovacích dovedností, matematických a statistických znalostí a odborných znalostí týkajících se obsahu přijala název "*Data Science*". Objevily se pozice takzvaných "*information designers*", které vyvíjí vlastní softwary pro vizualizaci dat, zakládají poradenské firmy, pořádají globální workshopy nebo vytvářejí blogy s tisíci registrovanými uživateli. [@datavis_rahlf]  Přes všechny výhody vizualizace, jedná se pouze o nástroj datové analýzy, obecně dostupný každému. Nesprávné či nevhodné použití tohoto nástrojů vede k tomu, že existují grafy, které se považují za moc barevné a rušivý, postrádající smysl až zavádějící. Z tohoto důvodů se obracíme na takzvané zásady vizualizace. 

\qquad Táto bakalářská práce se zabývá shrnutím klíčových poznatků o vizualizaci a průzkumové analýze dat a to jak z teoretického hlediska, tak i z hlediska praktické implementace v programovacím jazyku R.  Budou popsány zásady vizualizace, její zařazení do datové analýzy, moderní způsoby vizualizace (současně používané baličky v R, interaktivní grafy). Součásti práce je také webová aplikace pro vizualizaci a analýzu hydrologické bilance a předpověď sucha v útvarech povrchových vod ČR.

\newpage

# Teoretická část {-}

## 1 Vizualizace dat

### 1.1 Historie vizualizace dat

\qquad Před 17. stoletím jediné co by se dalo klasifikovat jako vizualizaci dat byly mapy pro navigaci a průzkum, ale také diagramy, geometrická schémata a tabulky pozic hvězd a jiných nebeských těles. Postupný vývoj statistické teorie a růst zájmu o data na konci 18. století vedly k inovacím a expanzi nových grafických forem. Kartografové se pokoušeli zaznamenat vice, než pouhou geografickou polohu na mapě a objevili se první pokusy o tematické mapování geologických, ekonomických a medicínských dat.

\qquad Wiliam Playfair (1759-1823) je obecně znám jako průkopník v oblasti vizualizace dat a je považován za vynálezce několika typů grafů. Například liniový a sloupcový grafy a grafy časových řád byly popsány v jeho práci z roku 1786 \textit{"Commercial and Political Atlas"}^[\textit{"Commercial and Political Atlas: Representing, by Copper-Plate Charts, the Progress of the Commerce, Revenues, Expenditure, and Debts of England, during the Whole of the Eighteenth Century"}]. Později popsal i koláčový graf ve své práci \textit{"Statistical Breviary"} v roce 1801. Obrázek \ref{fig0} ukazuje příklad jeho kreativní kombinace různých vizualizačních technik (kruhy, koláče, linie), pomocí které se snažil porovnat daňovou zátěž mezi Británii a dalšími zeměmi. Na tomto grafu také ukázal možnost použíti více měřítek pro různé ukazatele (v grafu populace a daně).

```{r playfair, fig.align='center', fig.cap="\\label{fig0} Kombinace různých vuzuálních techník, Playfair 1801", out.width= '100%', fig.pos='H', echo=FALSE}
knitr::include_graphics("fig/Playfair_taxes_population.jpg")
```
\newpage
\begin{wrapfigure}[17]{R}{0.45\textwidth}
    \centering
    \includegraphics[width=0.42\textwidth]{fig/Minard_1858}
    \caption{Dobytek odeslaný z celé Francie ke spotřebě v Paříži, Minard 1858}
    \label{fig01}
\end{wrapfigure}

\qquad V polovině 19. století byly vytvořeny všechny podmínky pro rychlý růst vizualizace. V důsledku rostoucí významnosti číselných informací pro sociální plánovaní, industrializaci, obchod a dopravu, byli zřízeny oficiální statistické úřady po celé Evropě. Vývoj statistické teorie, iniciovaný Gaussem a Laplacem, měl odezvu ve společností a poskytl prostředky ke zpracování velkého množství dat. Pro vizualizaci se stalo dat období 1850-1900 "Zlatý věkem", s jedinečnou krásou a velkým množstvím inovací. S těmito inovacemi je hlavně spojené jméno Charlese Josepha Minarda (1781-1870). Například, Minardem bylo zavedeno použití koláčových grafů s výsečemi na mapách (obrázek \ref{fig01}), kde velikost koláčového grafu ukazuje sumu za oblast neboli každý grafický region na mapě a výseče reprezentují dílčí součty za jednotlivé kategorie. Dále se také zabýval znázorněním geografických pohybu a dopravy lidí, zboží, importu a exportu úměrně jejich velikostí. \ Tento \ typ vizualizace \ se nazývá

\begin{wrapfigure}[12]{L}{0.51\textwidth}
    \centering
    \vspace{-10pt}
    \includegraphics[width=0.5\textwidth]{fig/minard_flow_map.jpg}
    \vspace{-10pt}
    \caption{Mapa světové migrace, Minard 1858}
    \label{fig02}
\end{wrapfigure}
\vspace{-7pt}
\textit{"flow maps"}, viz obrázek \ref{fig02}. Jednou z nejslavnějších jeho práci je zobrazení postupných ztrát mužů francouzské armády během Napoleonského tažení na Moskvu v letech 1812-1813 (obrázek \ref{fig03}). Je považovaná za nejlepší informativní vizualizací. I přestože v tomto grafu je celkem 6 proměnných (množství, lokace ve dvou rozměrech, postup armády, teplota, datum a skupiny), podařilo vše zobrazit tak, aniž by graf byl přeplněný a matoucí.

\newpage

\begin{figure}[H]
\centering
\includegraphics[width = \textwidth]{fig/Minard_1869}
\caption{Postup Napoleonských vojsk v letech 1812-13, Minard 1869}
\label{fig03}
\end{figure}

\qquad Začátek 20. století je občas nazýván "moderním temným věkem" vizualizace. V letech 1900-1950 bylo jen málo grafických inovací. Nadšení pro vizualizací, které charakterizovalo 19. století bylo nahrazeno formálními (z velké části statistickými) grafy a modely z oblasti sociologie. Hlavní zájem byl o přesná čísla, odhady parametrů, směrodatné odchylky. Vizualizace byli považované za pouhé hezké obrázky bez schopnosti podat přesná data. [@dataviz_history] Ve své práci \textit{"Graphic Methods for Presenting Facts"} z roku 1919 Willord C. Brinton [1880-1957] kritizoval a vysvětloval chyby takovýchto grafů. Například koláčový graf rozdělení rodinných příjmů (od 900\$ do 1000\$) na obrázku \ref{fig04}. Tento graf je příkladem nepovedené vizualizace: oko preferenčně soudí dle velikostí obrázků a ne dle uhlů výsečí. Obrázek uprostřed znázorňuje druhy utracení: je to zábavný způsob vizualizace, avšak nelze přesně určit velikost brašen, ani je porovnat mezi sebou. Další obrázek by měl čtenáři sdělit informaci, že prodej praček za poslední tří roky vzrostl sedmkrát. Z obrázku není patrný poměr sedmi ku jedné ani přesné roky kdy bylo provedeno porovnání údajů. Dále Brinton ve své práci upozorňoval, že neúspěšná prezentace dat může vést k chybným závěrům a také zmiňoval potřebu jakéhosi standardu, souhrnu "gramatických pravidel pro grafický jazyk". [@brinton_1919]

```{r brinton, fig.align='center', fig.cap="\\label{fig04} Ukázky vizualizaci ze začatku 20. století, Brinton 1919", out.width= '100%', fig.pos='H', echo=FALSE}
knitr::include_graphics("fig/brinton.png")
```

\qquad Ke "znovuzrození" vizualizace došlo v polovině šedesátých let 20. století, po napsaní Johnem W. Tukey [1915-2000] článku \textit{"The Future of Data Analysis"}, ve kterém vyzývá společnost k uznání analýzy dat jako samostatného oboru statistiky odlišného od matematické statistiky. [@tukey1962] Brzy poté začal Tukey s vývojem široké řady nových a efektivních grafů pod společným tématem "průzkumové analýzy dat" (popsány v jeho práci \textit{"Explanatory Data Analysis"} z roku 1977, viz o tématu kapitola [3](#EDA)). [@tukey1977] Mezi těmito novými grafy jsou například číslicový histogram (popsaný v kapitole [2.4.3](#stem-and-leaf)), boxplot nebo krabicový graf (popsaný v kapitole [2.3.2](#boxplot)) a další. Mnoho z nich je aktivně používáno ve statistické praxi a implementováno do většiny softwarů. [@dataviz_history] 

### 1.2 Zásady vizualizace dat

\qquad Od roku 1975 se vyvíjí statistické výpočetní systémy a s nimi i nové metody analýzy a vizualizace dat. V tomto období vizualizace začala být vnímána jako vlastní odvětví a to především díky Williamu S. Clevelandu a Edwardu Tufte, kteří položili věděcké základy tohoto odvětví. Tufte vyvinul a popularizoval terminologii a základní principy grafické integrity. Cleveland se zabýval studii grafického vnímání, kognitivních procesů, které lidi používají k pochopení grafů, a rozvíjel teorii o správném provedení vizualizaci. [@cleveland_priceonomics] Důsledek jejich práce se promítá i do současné doby kvalitní, interaktivní a dynamickou vizualizaci. [@dataviz_history]

#### 1.2.1 Edward Tufte {#tufte}

\qquad Za revoluční průlom se považuje kniha Edwarda Tufte *The Visual Display of Quantitative Information* z roku 1983, v kombinaci s dvěma následně publikovanými pracemi *Envisioning Information* z roku 1990 a *Visual Explanations* z roku 1997, patří mezi nejznámější publikace na téma vizualizace dat. Právě v těchto publikacích Tufte originálním způsobem definuje  "standard" vizualizace. [@datavis_rahlf] Ideální způsob vizualizace dle Tufte je stručný, elegantní a informativní. Příkladem ideálního grafu je pro Tufte graf postupu Napoleonských vojsk v letech 1812-13, vytvořený Minardem (viz obrázek \ref{fig03}). Tufte říká, že grafická elegance se často nachází v jednoduchosti návrhu a komplexnosti dat. [@tufte1990] Tafte formuluje základní principy vizualizace jako grafickou dokonalost a grafickou integritu. 

* **Grafická dokonalost** - grafika by měla:
  + být o datech a během jejich předvedení by nemělo dojít ke zkreslení
  + vyvolávat otázky o datech, ne o metodologii a technikách vizualizace
  + ukazovat velké množství dat v malém prostoru
  + předvádět velké datasety souvisle a logicky promyšleně
  + sloužit rozumnému a jasnému cíli (popisu, průzkumu, $\dots$)
  + být jednotná se statistickým nebo slovním popisem datasetu
* **Grafická integrita** neboli grafická celistvost a jednoznačnost
  + reprezentace čísel, zobrazené v grafu by měli být přímo úměrné číselným veličinám datasetu
  + jasné, detailní a svědomité označení v grafech by mělo potlačit zkreslení, nejasnost a dvojznačnost, popisky jsou důležitá
  + ukazovat variaci dat, nikoliv designu
  + v případě časových řad, představujících peníze, používat obecně známé jednotky
  + počet rozměrů představených v grafu by neměl přesahovat počet proměnných datasetu
  + reprezentace by neměla zahrnovat neúmyslný kontext

\vspace*{-0.75cm}
\begin{minipage}[H]{0.475\textwidth}
 \begin{figure}[H]
\centering
    \includegraphics[height = 10.5cm]{fig/tufte_shrinking_doctor}
    \caption{Zmenšující se rodinný lékař, Los Angeles Times, 1979}
    \label{fig05}
 \end{figure}
\end{minipage}
\begin{minipage}[H]{0.05\textwidth}
 \includegraphics[height = 9cm]{fig/blank_v}
\end{minipage}
\begin{minipage}[H]{0.475\textwidth}
 \begin{figure}[H]
\centering
    \includegraphics[height = 10.5cm]{fig/data_ink}
    \caption{Vztah skutečné míry volební registrace k předpovídaným hodnotám, přetištěné E. Tufte, 1983}
    \label{fig06}
 \end{figure}
\end{minipage}

Ve spojení s těmito principy byly zavedeny Edwardem Tuftem následující terminy:

* **Lie factor** je definován jako poměr velikosti efektu zobrazeného v grafu oproti velikosti efektu v datech. Pokud se rovná jedničce, považuji se reprezentované hodnoty za přesné. Pokud je faktor větší než 1.05 či menší než 0.95, indikuje se podstatné zkreslení, přesahující míru drobných nepřesnosti vyskytujících se při vykreslováni grafů. Tafte ve své práci uvádí jako jeden z příkladů graf na obrázku \ref{fig05}. Tento graf zobrazující zmenšující se procento lékařů věnujících se výhradně rodinné praxi má *lie factor* odpovídající hodnotě 2.8, tedy skutečný pokles je značně nadhodnocen.
* **Data ink ratio** - poměr, který vyhodnocuje hustotu grafu a obsah informací. Dal by se vyjádřit vzorcem 
$$\textit{Data ink ratio} = \cfrac{\textit{data-ink}}{\textit{celkový inkoust použitý v datech}},$$
kde $\textit{data-ink}$ je nezbytné jádro grafu a smazání jakékoliv jeho části znamená ztrátu informaci. 
Tento vztah také odpovídá podílu grafického inkoustu požitého k vykreslení nepodstatných informací. Dalo by se to také vyjádřit jako jedna mínus \textit{podíl grafiky, která může být vymazána bez ztráty informací}. Tafte doporučuje tento faktor maximalizovat v rozumných mezích, nejlépe se  vyhnout těžkým mřížkovým liniím na pozadí (dokonce i horizontálním referenčním liniím). V příkladu na obrázku \ref{fig06} jsou zobrazené dvě verze stejného grafu. Horní má hodnotu *data ink ratio* kolem 0.7, dolní graf ale neobsahuje informaci o datech, pouze nápomocné čáry, proto *data ink ratio* se rovná nule. 
* **Chartjunk** - se vztahuje ke všem vizuálním elementům, které  neslouží ke komunikaci informací zobrazených v grafu nebo odvádějí pozornost od těchto informací. [@tufte1983]

#### 1.2.2 Wiliam S. Cleveland {#cleveland}

\qquad Kromě práci Edwarda Tufte velký vliv měli i publikace Wiliama S. Clevelanda. Cleveland se svým kolegou Robertem McGillem publikovali v roce 1984 článek o grafickém vnímání [@cleveland_mcgill]. Prováděli studie na rozdíl ve vnímání sloupcových grafů (pozice a obecné měřítko), koláčových grafů (úhel), skládaných sloupcových grafů (plocha), barevných a stínovaných map (saturace barev a stínování) a další. [@cleveland_priceonomics] Ve svých pracích  *Visualizing data* z roku 1993 a *The Elements of Graphing Data* z roku 1994 Cleveland se zabýval principy vizualizace, grafickými metodami a technikami, vykreslením tři a více proměnných (rozměrů). Některé z jeho principů se schodují s principy vymezenými Tuftem, avšak práce Clevelanda v této oblasti přesahovala práci Tufte. Zásady a principy dle Clevelanda by se dali shrnout do čtyř hlavních kategorií: jasný vzhled, jasná srozumitelnost, měřítka, obecné postupy. [@cleveland1994]

* **Jasný vzhled**
  + Data by měla vyčnívat, vykreslení nadbytečných prvků (neboli *chartjunk* dle Tufta) by se mělo vyhnout.
  + Ke zobrazení dat by se měli používat výrazné grafické prvky. 
  + Pro každou proměnnou by měla být použita dvojice os, prostor v takto vytvořeným obdélníku je určen k vykreslení grafu, značky na osách by měli směrovat mimo oblast grafu.
  + Prostor grafu by neměl být přeplněný (legenda mimo oblast grafu atd.). 
  + S počtem značek na osách by se nemělo přehánět. 
  + Pokud je vhodné, referenční linie mohou být použity, avšak nesmějí zasahovat do dat. 
  + Popisky by neměli  zasahovat  do kvantitativních dat a nesmějí znepřehledňovat graf. 
  + Značky a klíče by měli vyskytovat mimo oblast grafu (případně v legendě), totéž se týká poznámek a nadpisů, které mohou být také umístěny do textu.
  + Překrývající se data sety či symboly musí být visuálně snadně rozpoznatelné. 
  + Jasnost obrazu musí být zachována při reprodukci i při snížení kvality a zmenšení rozlišení.

Cleveland jako příklad špatně zpracované vizualizace vybral graf \ref{fig07a}, na kterém je zobrazeno množství izotopu xenonu ${}^{133}\mbox{Xe}$ ve vzduchu ($pCi.m^{-3}$) po havárii elektrárny Three Mile Island v Albany, New York koncem března a začátkem dubna roku 1979. Vše, včetně popisků os, klíčů a popisků dat bylo umístěno do oblasti grafu, není dodržená žádná ze zásad Clevelanda. Výsledkem je matoucí graf, který je obtížné číst. Stejná data byla vizualizována Clevelandem na grafu \ref{fig07b} s dodržením veškerých zásad: odstranění zbytečných objektů a detailu z oblasti grafu, rozlišné datasety se zobrazují ve vlastních panelech, oprava popisků popisujících měření. 

\vspace*{-0.6cm}
\begin{figure}[H]
  \begin{subfigure}{0.57\textwidth}
  \centering
    \vspace*{0.65cm}
      \includegraphics[width=\textwidth]{fig/cleveland_xenon_133}
      \vspace*{0.2cm}
      \caption{}
      \label{fig07a}
  \end{subfigure}%
  \begin{subfigure}[H]{0.43\textwidth}
  \centering
      \includegraphics[width=\textwidth]{fig/cleveland_xenon_opr}
      \vspace*{-0.8cm}
      \caption{}
      \label{fig07b}
  \end{subfigure}
\vspace*{-0.25cm}
\caption{Radioaktivní oblak při havárie elektrárny Three Mile Island: ${}^{133}\mbox{Xe}$ ve vzduchu ve vzdálenosti 375 km (a) a stejný graf přepracovaný Clevelandem (b), 1994}
\label{fig07}
\end{figure}  

\newpage
* **Jasná srozumitelnost**
  + Hlavní závěry by měli být obsaženy v grafické formě. Legenda a nadpisy by měli být srozumitelné a vyčerpávající.
  + Grafy by měli být zkontrolovány.
  + Mělo by se usilovat o přehlednost (viz "jasný vzhled").
  
* **Měřitka**
  + Volit rozsah os tak, aby obsahoval, případně téměř obsahoval, rozsah dat. 
  + Volit takové měřítko, aby data vyplňovala co největší prostor. 
  + Občas je užitečný mít pro proměnnou dvě osy pro rozdílná měřítka.
  + Volit vhodné měřítko pokud data jsou porovnávány na více panelech.
  + Osy grafu nemusejí vždy nutně zahrnovat nulu pro ukázku rozsahu.
  + Použit logaritmická měřítka, když je důležitý pochopit procentní změny nebo multiplikativní faktory. 
  + Použit přerušené měřítko pouze v případě potřeby. Logaritmování může zbavit této potřeby.
  
* **Obecné postupy**
  + Velké množství kvantitativní informace může být vměstnáno do relativně malých oblastí. 
  + Tvorba grafů by měla být opakující, iterativní, experimentální činností.
  + Data by měla být vykreslena tolikrát kolikrát je třeba. 
  + Užitečné grafy vyžadují pečlivou a detailní práci.

### 1.3 Grammar of graphics {#gg}

\qquad \textit{The Grammar of Graphics} publikována Lelandem Wilkinsonem v roce 2005 [@wilkinson2005], detailně popisuje prvky, které tvoří základ všech statistických grafů, a odpovídá na základní otázku: co je statistická grafika? [@wickham_ggplot] Tato publikace měla extrémně velký vliv na myšlení o grafech. Hadley Wickham na základě Wilkinsonovy gramatiky publikoval v roce 2009 článek *A Layered Grammar of Graphics* [@layered-grammar], který se zaměřuje primárně na vrstvy a jejich zapojení do R. Následně také pro něj posloužila jako inspirace pro tvorbu balíčku `ggplot` (viz kapitola [4.2.1](#ggplot)). 

\qquad \textit{The Grammar of Graphics} říká, že statistické grafy jsou mapováním z dat k estetickým atributům (barva, tvar, velikost) nebo geometrickým objektům (body, linie, sloupce). Graf také může obsahovat statistickou transformaci dat a být vykreslen ve specifickém souřadnicovém systému. *Faceting* může být použito k vygenerování stejného grafů pro různé podmnožiny datasetu. Kombinace těchto nezávislých komponent tvoří grafiku.

\qquad Jednotlivé komponenty tvořící graf, dle Wilkinsonovy syntaxe, by se dalo zapsat následovně:

* Vizualizované **data** a soubor estetických mapování (**mapping**s), popisujících, jak proměnné z dat jsou mapovány na vnímané estetické atributy.
* Geometrické objekty (**geom**s) reprezentují to, co je doopravdy na grafu: body, linie, polygony atd.
* Statistické transformace (**stat**s) sumarizují data mnoha užitečnými způsoby. Jako příklad by se dáli použit výpočty intervalů a počtu pozorování při tvorbě histogramu (kapitola [2.4.1](#hist)) nebo tvorbu lineárního modelu. Statistické transformace patří k nepovinným, ale velmi užitečným komponentům.
* Měřítka (**scale**s) reprezentují hodnoty v datovém prostoru převedené na hodnoty v estetickém prostoru, ať už se jedná o barvu, velikost či tvar. Na měřítku závisí legenda a osy, tvořené inverzním mapováním, umožňující číst z grafu původní hodnoty datasetu.
* Souřadnicový systém (**coord**) popisuje, jak jsou souřadnice dat mapovány do roviny grafiky. Rovněž poskytuje osy a mřížky, umožňující čtení grafů. Běžně se používá kartézský souřadnicový systém, ale je k dispozici i řada dalších systémů, včetně polárních souřadnicích a mapových projekcí.
* Specifikace **facet**ing popisuje, jaké proměnné by měli být použity k rozdělení dat na podmnožiny a jak tyto podmnožiny by měly být uspořádány. Jedná se o mocný nástroj pro zkoumání toho, zda jsou modely stejné nebo odlišné v různých podmínkách.

\qquad Je také důležité zmínit, o čem Wilkinsova gramatika není. Nenaznačuje, jaký typ grafů by se měl použit k zodpovězení otázek o datech, jak to dělali Cleveland [@cleveland1993] nebo Tukey [@tukey1977], zaměřuje se konkretně na jejich tvorbu. Ironií je, že \textit{The Grammar of Graphics} neurčuje, jak by měla vypadat grafika, nespecifikuje velikost písma ani barvu pozadí. Otázkou vzhledu grafů se zabývali Tufte a Cleveland (kapitoly [1.2.1](#tufte) a [1.2.2](#cleveland)). Dále Wilkinsova gramatika nepopisuje interakce, obsahuje pouze statické grafy. Při tvorbě dynamických či interaktivních grafů je třeba se obrátit na jiný zdroj. [@wickham_ggplot]
